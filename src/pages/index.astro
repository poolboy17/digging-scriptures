---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import CdnImage from '../components/CdnImage.astro';

const hubs = await getCollection('hubs', ({ data }) => !data.draft);
const places = await getCollection('places', ({ data }) => !data.draft);
const routes = await getCollection('routes', ({ data }) => !data.draft);
const stories = await getCollection('stories', ({ data }) => !data.draft);
const contextArticles = await getCollection('context', ({ data }) => !data.draft);

const totalArticles = hubs.length + places.length + routes.length + stories.length + contextArticles.length;

// ──────────────────────────────────────────────────────────
// BUILD HUB DATA: each hub gets its spoke articles attached
// This drives the hub-spoke sections on the homepage
// ──────────────────────────────────────────────────────────
const hubData = await Promise.all(hubs.map(async (hub) => {
    const hubSlug = hub.slug;
    const hubPlaces = places.filter(p => p.data.parentHub === hubSlug);
    const hubRoutes = routes.filter(r => r.data.parentHub === hubSlug);
    
    // Pick representative spokes to feature (up to 3)
    const featuredSpokes = [
        ...hubPlaces.slice(0, 2).map(p => ({ 
            title: p.data.title, 
            href: `/places/${p.slug}`,
            type: 'Place' as const
        })),
        ...hubRoutes.slice(0, 1).map(r => ({ 
            title: r.data.title, 
            href: `/routes/${r.slug}`,
            type: 'Route' as const
        })),
    ];
    
    return {
        ...hub,
        spokeCount: hubPlaces.length + hubRoutes.length,
        featuredSpokes,
    };
}));

// Featured place for hero
const featuredPlace = places.find(p => p.slug === 'jerusalem-old-city') || places[0];

// Section counts for the explore grid
const sections = [
    { name: 'Sacred Places', href: '/places', count: places.length, desc: 'Shrines, temples, and pilgrimage destinations where faith and geography converge', icon: 'place' },
    { name: 'Pilgrimage Routes', href: '/routes', count: routes.length, desc: 'Ancient and modern paths walked by pilgrims across centuries and continents', icon: 'route' },
    { name: 'Stories & Legends', href: '/stories', count: stories.length, desc: 'The people, miracles, and narratives that shaped pilgrimage traditions', icon: 'story' },
    { name: 'Historical Context', href: '/context', count: contextArticles.length, desc: 'Background articles illuminating the history and theology of sacred travel', icon: 'context' },
];

// Schema
const homepageSchema = {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "Digging Scriptures",
    "description": "A scholarly guide to pilgrimage traditions, sacred places, and faith-based travel across world religions.",
    "url": "https://diggingscriptures.com",
    "publisher": {
        "@type": "Organization",
        "name": "Digging Scriptures",
        "url": "https://diggingscriptures.com"
    }
};
---

<BaseLayout 
    title="Digging Scriptures — Sacred Places & Pilgrimage Travel" 
    description="A cultural, historical, and experiential guide to pilgrimage traditions, sacred places, and faith-based travel across world religions."
    schema={homepageSchema}
>

<!-- ════════════════════════════════════════════════════════ -->
<!-- HERO                                                    -->
<!-- ════════════════════════════════════════════════════════ -->
<section class="hero">
    {featuredPlace?.data.image && (
        <div class="hero-img-wrap">
            <CdnImage 
                src={featuredPlace.data.image}
                alt={featuredPlace.data.imageAlt || featuredPlace.data.title}
                width={1200} height={600}
                loading="eager"
                fetchpriority="high"
                sizes="100vw"
                class="hero-img"
            />
        </div>
    )}
    <div class="hero-overlay"></div>
    <div class="hero-content container">
        <p class="hero-eyebrow">Scholarly pilgrimage research across world religions</p>
        <h1 class="hero-title">
            Sacred places.<br class="hero-br" />Ancient routes.<br class="hero-br" />Living traditions.
        </h1>
        <p class="hero-subtitle">
            We trace the routes, uncover the history, and explore the sites where 
            tradition, geography, and devotion converge — across Christianity, Islam, 
            Judaism, Buddhism, and Hinduism.
        </p>
        <div class="hero-actions">
            {hubData.slice(0, 3).map((hub) => (
                <a href={`/journeys/${hub.slug}`} class="hero-hub-pill">{hub.data.title.replace(' Pilgrimage Traditions', '').replace(' Pilgrimage Paths', '').replace(' Pilgrimage Heritage', '').replace(' Journeys and Pilgrimages', '').replace('Faith-Based', 'All Traditions')}</a>
            ))}
        </div>
    </div>
</section>


<!-- ════════════════════════════════════════════════════════ -->
<!-- STATS BAR                                               -->
<!-- ════════════════════════════════════════════════════════ -->
<section class="stats-bar">
    <div class="container">
        <div class="stats-grid">
            <div class="stat">
                <span class="stat-num">{totalArticles}</span>
                <span class="stat-label">Articles</span>
            </div>
            <div class="stat">
                <span class="stat-num">{hubs.length}</span>
                <span class="stat-label">Traditions</span>
            </div>
            <div class="stat">
                <span class="stat-num">{places.length}</span>
                <span class="stat-label">Sacred places</span>
            </div>
            <div class="stat">
                <span class="stat-num">{routes.length}</span>
                <span class="stat-label">Routes</span>
            </div>
        </div>
    </div>
</section>


<!-- ════════════════════════════════════════════════════════ -->
<!-- TIER-1 HUBS — The core of the SEO pyramid               -->
<!-- Each hub card shows image, description, and spoke links  -->
<!-- This is the primary link equity section                  -->
<!-- ════════════════════════════════════════════════════════ -->
<section class="section container">
    <div class="section-header">
        <span class="section-label">Pilgrimage traditions</span>
        <h2 class="section-title">Explore by world religion</h2>
    </div>

    <div class="hub-stack">
        {hubData.map((hub, i) => (
            <article class="hub-row">
                <a href={`/journeys/${hub.slug}`} class="hub-row-img-link">
                    {hub.data.image && (
                        <CdnImage 
                            src={hub.data.image}
                            alt={hub.data.imageAlt || hub.data.title}
                            width={480} height={320}
                            loading={i < 2 ? 'eager' : 'lazy'}
                            decoding={i < 2 ? 'sync' : 'async'}
                            class="hub-row-photo"
                        />
                    )}
                </a>
                <div class="hub-row-body">
                    <a href={`/journeys/${hub.slug}`} class="hub-row-title-link">
                        <h3 class="hub-row-title">{hub.data.title}</h3>
                    </a>
                    <p class="hub-row-desc">{hub.data.description}</p>
                    {hub.featuredSpokes.length > 0 && (
                        <div class="hub-row-spokes">
                            {hub.featuredSpokes.map((spoke) => (
                                <a href={spoke.href} class="hub-spoke-chip">
                                    <span class="hub-spoke-type">{spoke.type}</span>
                                    {spoke.title}
                                </a>
                            ))}
                        </div>
                    )}
                    <a href={`/journeys/${hub.slug}`} class="hub-row-cta">
                        Read full guide <span class="hub-row-arrow">&rarr;</span>
                    </a>
                </div>
            </article>
        ))}
    </div>
</section>


<!-- ════════════════════════════════════════════════════════ -->
<!-- BROWSE BY TYPE — Secondary nav into content types       -->
<!-- ════════════════════════════════════════════════════════ -->
<section class="section container">
    <div class="section-header">
        <span class="section-label">Browse</span>
        <h2 class="section-title">Content by type</h2>
    </div>
    <div class="explore-grid">
        {sections.map((sec) => (
            <a href={sec.href} class="explore-card">
                <div class="explore-icon-wrap">
                    <svg class="explore-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        {sec.icon === 'place' && <><circle cx="12" cy="10" r="3" /><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" /></>}
                        {sec.icon === 'route' && <><path d="M3 17l4-4 4 4 4-4 4 4" /><path d="M3 7l4 4 4-4 4 4 4-4" /></>}
                        {sec.icon === 'story' && <><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" /><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" /></>}
                        {sec.icon === 'context' && <><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></>}
                    </svg>
                </div>
                <div class="explore-text">
                    <h3 class="explore-name">{sec.name}</h3>
                    <p class="explore-desc">{sec.desc}</p>
                </div>
                <span class="explore-count">{sec.count}</span>
            </a>
        ))}
    </div>
</section>


<!-- ════════════════════════════════════════════════════════ -->
<!-- ABOUT                                                   -->
<!-- ════════════════════════════════════════════════════════ -->
<section class="section container">
    <div class="about-block">
        <h2 class="about-heading">What is Digging Scriptures?</h2>
        <div class="about-cols">
            <p>
                We examine pilgrimage as a human phenomenon — where people have traveled, 
                why they undertook these paths, and how sacred travel has developed across 
                traditions and centuries. Our approach is descriptive and historical, grounded 
                in evidence and respectful of all faith traditions.
            </p>
            <p>
                We cover <a href="/journeys/christian-pilgrimage-traditions">Christianity</a>, 
                <a href="/journeys/jewish-pilgrimage-heritage">Judaism</a>, 
                <a href="/journeys/islamic-pilgrimage-traditions">Islam</a>, 
                <a href="/journeys/buddhist-pilgrimage-paths">Buddhism</a>, Hinduism, and indigenous 
                practices with equal scholarly rigor. Every article distinguishes documented 
                history from tradition, names its sources, and lets readers form their own 
                conclusions.
            </p>
        </div>
    </div>
</section>

</BaseLayout>

<style>
/* ═══════════════════════════════════════════════════════ */
/* HERO                                                    */
/* ═══════════════════════════════════════════════════════ */
.hero {
    position: relative;
    overflow: hidden;
    min-height: 420px;
    display: flex;
    align-items: flex-end;
}

@media (min-width: 640px) { .hero { min-height: 520px; } }
@media (min-width: 900px) { .hero { min-height: 560px; } }

.hero-img-wrap { position: absolute; inset: 0; }
.hero-img { width: 100%; height: 100%; object-fit: cover; object-position: center 40%; }

.hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top,
        rgba(15,12,10,0.92) 0%,
        rgba(15,12,10,0.70) 40%,
        rgba(15,12,10,0.35) 100%);
}

.hero-content {
    position: relative; z-index: 2;
    padding: 3rem 0 2.75rem;
    color: #fafaf9;
}

@media (min-width: 640px) { .hero-content { padding: 4rem 0 3.5rem; } }
@media (min-width: 900px) { .hero-content { padding: 5rem 0 4rem; } }

.hero-eyebrow {
    font-size: 0.6875rem; font-weight: 600;
    letter-spacing: 0.08em; text-transform: uppercase;
    color: rgba(139,92,246,0.9);
    margin-bottom: 1rem;
}

@media (min-width: 640px) { .hero-eyebrow { font-size: 0.75rem; margin-bottom: 1.25rem; } }

.hero-title {
    font-family: var(--font-serif);
    font-size: clamp(1.75rem, 5vw, 3.25rem);
    font-weight: 800; line-height: 1.15;
    letter-spacing: -0.025em;
    margin-bottom: 1.25rem;
}

.hero-br { display: inline; }
@media (min-width: 640px) { .hero-br { display: block; } }

.hero-subtitle {
    max-width: 36rem;
    font-size: 0.9375rem; line-height: 1.7;
    color: rgba(168,162,158,0.9);
    margin-bottom: 2rem;
}

@media (min-width: 640px) { .hero-subtitle { font-size: 1rem; margin-bottom: 2.5rem; } }

.hero-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; }

.hero-hub-pill {
    display: inline-flex; align-items: center;
    padding: 0.5rem 1rem;
    border: 1px solid rgba(139,92,246,0.4);
    background: rgba(109,40,217,0.15);
    color: #c4b5fd;
    font-size: 0.8125rem; font-weight: 600;
    border-radius: 2rem;
    text-decoration: none;
    transition: all 0.2s;
    backdrop-filter: blur(4px);
}

.hero-hub-pill:hover {
    background: rgba(109,40,217,0.35);
    border-color: rgba(139,92,246,0.7);
    color: #ede9fe;
}

@media (min-width: 640px) { .hero-hub-pill { padding: 0.5625rem 1.25rem; font-size: 0.875rem; } }


/* ═══════════════════════════════════════════════════════ */
/* STATS BAR                                               */
/* ═══════════════════════════════════════════════════════ */
.stats-bar {
    background: #ffffff;
    border-bottom: 1px solid var(--color-border);
    padding: 1.25rem 0;
}

@media (min-width: 640px) { .stats-bar { padding: 1.75rem 0; } }

.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem; text-align: center;
}

@media (min-width: 480px) { .stats-grid { grid-template-columns: repeat(4, 1fr); gap: 1rem; } }

.stat-num {
    display: block; font-size: 1.375rem; font-weight: 800;
    color: #1c1917; letter-spacing: -0.02em;
}

@media (min-width: 640px) { .stat-num { font-size: 1.75rem; } }

.stat-label {
    font-size: 0.6875rem; text-transform: uppercase;
    letter-spacing: 0.06em; color: #a8a29e; font-weight: 500;
}


/* ═══════════════════════════════════════════════════════ */
/* SECTION HEADINGS                                        */
/* ═══════════════════════════════════════════════════════ */
.section-header { margin-bottom: 1.5rem; }
@media (min-width: 640px) { .section-header { margin-bottom: 2rem; } }

.section-label {
    display: inline-block; font-size: 0.6875rem; font-weight: 600;
    letter-spacing: 0.1em; text-transform: uppercase;
    color: var(--color-primary); margin-bottom: 0.375rem;
}

.section-title {
    font-size: 1.375rem; font-weight: 800;
    letter-spacing: -0.02em; color: var(--color-text-dark);
}

@media (min-width: 640px) { .section-title { font-size: 1.625rem; } }


/* ═══════════════════════════════════════════════════════ */
/* HUB STACK — Tier-1 hub cards with spoke links           */
/* ═══════════════════════════════════════════════════════ */
.hub-stack {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

@media (min-width: 640px) { .hub-stack { gap: 1.5rem; } }

.hub-row {
    display: flex;
    flex-direction: column;
    background: #ffffff;
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    overflow: hidden;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.hub-row:hover {
    border-color: color-mix(in srgb, var(--color-primary) 40%, transparent);
    box-shadow: 0 2px 16px rgba(0,0,0,0.04);
}

@media (min-width: 640px) {
    .hub-row { flex-direction: row; }
}

.hub-row-img-link {
    flex-shrink: 0;
    display: block;
    overflow: hidden;
    height: 180px;
}

@media (min-width: 640px) {
    .hub-row-img-link { width: 240px; height: auto; }
}

@media (min-width: 900px) {
    .hub-row-img-link { width: 280px; }
}

.hub-row-photo {
    width: 100%; height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
}

.hub-row:hover .hub-row-photo { transform: scale(1.04); }

.hub-row-body {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    flex: 1;
    min-width: 0;
}

@media (min-width: 640px) { .hub-row-body { padding: 1.5rem 1.75rem; } }

.hub-row-title-link { text-decoration: none; }

.hub-row-title {
    font-size: 1.0625rem; font-weight: 800;
    color: var(--color-text-dark);
    margin-bottom: 0.375rem;
    line-height: 1.3;
    transition: color 0.15s;
}

.hub-row-title-link:hover .hub-row-title { color: var(--color-primary); }

@media (min-width: 640px) { .hub-row-title { font-size: 1.125rem; } }

.hub-row-desc {
    font-size: 0.8125rem; color: var(--color-text-muted);
    line-height: 1.65; margin-bottom: 0.875rem;
}

@media (min-width: 640px) { .hub-row-desc { font-size: 0.875rem; } }

/* Spoke chips — inline links to spoke articles */
.hub-row-spokes {
    display: flex; flex-wrap: wrap; gap: 0.375rem;
    margin-bottom: 1rem;
}

.hub-spoke-chip {
    display: inline-flex; align-items: center; gap: 0.375rem;
    padding: 0.3125rem 0.625rem;
    background: var(--color-light);
    border: 1px solid var(--color-border);
    border-radius: 0.375rem;
    font-size: 0.75rem; font-weight: 500;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: all 0.15s;
    white-space: nowrap;
}

.hub-spoke-chip:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
    background: #f5f3ff;
}

.hub-spoke-type {
    font-size: 0.625rem; font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--color-primary);
    opacity: 0.7;
}

.hub-row-cta {
    display: inline-flex; align-items: center; gap: 0.25rem;
    font-size: 0.8125rem; font-weight: 600;
    color: var(--color-primary);
    text-decoration: none;
    transition: gap 0.2s;
}

.hub-row-cta:hover { gap: 0.5rem; }

.hub-row-arrow { transition: transform 0.2s; }
.hub-row-cta:hover .hub-row-arrow { transform: translateX(2px); }


/* ═══════════════════════════════════════════════════════ */
/* EXPLORE GRID                                            */
/* ═══════════════════════════════════════════════════════ */
.explore-grid { display: grid; gap: 0.625rem; }
@media (min-width: 640px) { .explore-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; } }

.explore-card {
    display: flex; align-items: center; gap: 0.75rem;
    padding: 1rem 1.125rem;
    background: #ffffff; border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    text-decoration: none; transition: all 0.2s;
    min-width: 0;
}

@media (min-width: 640px) { .explore-card { padding: 1.25rem 1.5rem; gap: 1rem; } }

.explore-card:hover {
    border-color: var(--color-primary);
    box-shadow: 0 2px 12px rgba(0,0,0,0.04);
}

.explore-icon-wrap {
    flex-shrink: 0; width: 2.5rem; height: 2.5rem;
    display: flex; align-items: center; justify-content: center;
    background: #f5f3ff; border-radius: 0.625rem;
}

@media (min-width: 640px) { .explore-icon-wrap { width: 2.75rem; height: 2.75rem; } }

.explore-svg { width: 1.125rem; height: 1.125rem; color: var(--color-primary); }
@media (min-width: 640px) { .explore-svg { width: 1.25rem; height: 1.25rem; } }

.explore-text { min-width: 0; flex: 1; }

.explore-name {
    font-size: 0.875rem; font-weight: 700;
    color: var(--color-text-dark); margin-bottom: 0.125rem;
}

.explore-desc {
    font-size: 0.75rem; color: var(--color-text-muted);
    line-height: 1.4;
    display: -webkit-box; -webkit-line-clamp: 2;
    -webkit-box-orient: vertical; overflow: hidden;
}

@media (min-width: 640px) { .explore-desc { font-size: 0.8125rem; } }

.explore-count {
    margin-left: auto; flex-shrink: 0;
    font-size: 1.125rem; font-weight: 800;
    color: var(--color-primary);
}


/* ═══════════════════════════════════════════════════════ */
/* ABOUT                                                   */
/* ═══════════════════════════════════════════════════════ */
.about-block { max-width: 48rem; }

.about-heading {
    font-size: 1.25rem; font-weight: 800;
    color: var(--color-text-dark); letter-spacing: -0.02em;
    margin-bottom: 1rem; padding-bottom: 0.875rem;
    border-bottom: 2px solid var(--color-primary);
    display: inline-block;
}

@media (min-width: 640px) { .about-heading { font-size: 1.375rem; margin-bottom: 1.25rem; padding-bottom: 1rem; } }

.about-cols { display: grid; gap: 1rem; }
@media (min-width: 640px) { .about-cols { grid-template-columns: 1fr 1fr; gap: 2rem; } }

.about-cols p {
    font-size: 0.875rem; color: var(--color-text-muted);
    line-height: 1.75; margin: 0;
}

@media (min-width: 640px) { .about-cols p { font-size: 0.9375rem; } }
</style>
