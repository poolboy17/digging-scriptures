---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const hubs = await getCollection('hubs', ({ data }) => !data.draft);
const places = await getCollection('places', ({ data }) => !data.draft);
const routes = await getCollection('routes', ({ data }) => !data.draft);
const stories = await getCollection('stories', ({ data }) => !data.draft);

// Combine all content into a single feed
const allContent = [
    ...hubs.map(h => ({ ...h, category: 'Journeys', href: `/journeys/${h.slug}` })),
    ...places.map(p => ({ ...p, category: 'Places', href: `/places/${p.slug}` })),
    ...routes.map(r => ({ ...r, category: 'Routes', href: `/routes/${r.slug}` })),
    ...stories.map(s => ({ ...s, category: 'Stories', href: `/stories/${s.slug}` })),
];

const featured = allContent[0];
const rest = allContent.slice(1);
---

<BaseLayout 
    title="Digging Scriptures — Sacred Places, Pilgrimages, and Faith-Based Travel" 
    description="A cultural, historical, and experiential guide to pilgrimage traditions, sacred places, and faith-based travel."
>
    <section class="section">
        {/* Featured article — large hero card */}
        {featured && (
            <a href={featured.href} class="card block mb-12">
                <div class="overflow-hidden rounded-lg">
                    <img 
                        src={featured.data.image || '/images/posts/pilgrimage-default.svg'} 
                        alt={featured.data.title}
                        width="925" height="475"
                        class="w-full aspect-[925/475] object-cover" loading="lazy" decoding="async"
                    />
                </div>
                <div class="pt-6">
                    <div class="card-meta">
                        <span class="badge">{featured.category}</span>
                    </div>
                    <h2 class="mb-3 text-text-dark hover:text-primary transition-colors">
                        {featured.data.title}
                    </h2>
                    <p class="text-text-muted leading-relaxed line-clamp-2">
                        {featured.data.description}
                    </p>
                </div>
            </a>
        )}

        {/* Card grid — 2 columns */}
        {rest.length > 0 && (
            <div class="grid gap-8 sm:grid-cols-2">
                {rest.map((item) => (
                    <a href={item.href} class="card block">
                        <div class="overflow-hidden rounded-lg">
                            <img 
                                src={item.data.image || '/images/posts/pilgrimage-default.svg'} 
                                alt={item.data.title}
                                width="445" height="230"
                                class="w-full aspect-[445/230] object-cover" loading="lazy" decoding="async"
                            />
                        </div>
                        <div class="pt-4">
                            <div class="card-meta">
                                <span class="badge">{item.category}</span>
                            </div>
                            <h3 class="mb-2 text-text-dark hover:text-primary transition-colors">
                                {item.data.title}
                            </h3>
                            <p class="text-sm text-text-muted leading-relaxed line-clamp-2">
                                {item.data.description}
                            </p>
                        </div>
                    </a>
                ))}
            </div>
        )}
    </section>
</BaseLayout>
