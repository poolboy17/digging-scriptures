---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import CdnImage from '../components/CdnImage.astro';

const hubs = await getCollection('hubs', ({ data }) => !data.draft);
const places = await getCollection('places', ({ data }) => !data.draft);
const routes = await getCollection('routes', ({ data }) => !data.draft);
const stories = await getCollection('stories', ({ data }) => !data.draft);
const contextArticles = await getCollection('context', ({ data }) => !data.draft);

// All published content sorted by lastUpdated
const allContent = [
    ...places.map(p => ({ ...p, category: 'Place', href: `/places/${p.slug}`, icon: 'üìç' })),
    ...routes.map(r => ({ ...r, category: 'Route', href: `/routes/${r.slug}`, icon: 'ü•æ' })),
    ...stories.map(s => ({ ...s, category: 'Story', href: `/stories/${s.slug}`, icon: 'üìñ' })),
    ...contextArticles.map(c => ({ ...c, category: 'Context', href: `/context/${c.slug}`, icon: 'üîé' })),
].sort((a, b) => {
    const dateA = a.data.lastUpdated ? new Date(a.data.lastUpdated).getTime() : 0;
    const dateB = b.data.lastUpdated ? new Date(b.data.lastUpdated).getTime() : 0;
    return dateB - dateA;
});

const totalArticles = hubs.length + allContent.length;

// Section counts for the explore grid
const sections = [
    { name: 'Sacred Places', href: '/places', count: places.length, desc: 'Where faith, history, and geography converge', icon: 'üìç' },
    { name: 'Pilgrimage Routes', href: '/routes', count: routes.length, desc: 'Ancient paths walked across centuries', icon: 'ü•æ' },
    { name: 'Stories & Legends', href: '/stories', count: stories.length, desc: 'People and narratives behind the sites', icon: 'üìñ' },
    { name: 'Historical Context', href: '/context', count: contextArticles.length, desc: 'Background illuminating pilgrimage', icon: 'üîé' },
];
---

<BaseLayout 
    title="Digging Scriptures ‚Äî Sacred Places & Pilgrimage Travel" 
    description="A cultural, historical, and experiential guide to pilgrimage traditions, sacred places, and faith-based travel across world religions."
>

<!-- HERO -->
<section class="hero">
    <div class="hero-inner container">
        <p class="hero-eyebrow">Scholarly pilgrimage research across world religions</p>
        <h1 class="hero-title">
            Sacred places.<br />Ancient routes.<br />Living traditions.
        </h1>
        <p class="hero-subtitle">
            We trace the routes, uncover the history, and explore the sites where 
            tradition, geography, and devotion converge ‚Äî across Christianity, Islam, 
            Judaism, Buddhism, and Hinduism.
        </p>
        <div class="hero-actions">
            <a href="/journeys" class="btn">Explore traditions</a>
            <a href="/places" class="btn-outline-hero">Browse places &rarr;</a>
        </div>
    </div>
</section>


<!-- STATS BAR -->
<section class="stats-bar">
    <div class="container">
        <div class="stats-grid">
            <div class="stat">
                <span class="stat-number">{totalArticles}</span>
                <span class="stat-label">Articles</span>
            </div>
            <div class="stat">
                <span class="stat-number">{hubs.length}</span>
                <span class="stat-label">Traditions</span>
            </div>
            <div class="stat">
                <span class="stat-number">{places.length}</span>
                <span class="stat-label">Sacred Places</span>
            </div>
            <div class="stat">
                <span class="stat-number">{routes.length}</span>
                <span class="stat-label">Routes</span>
            </div>
        </div>
    </div>
</section>


<!-- EXPLORE BY TYPE -->
<section class="section container">
    <div class="section-header">
        <span class="section-label">Explore</span>
        <h2 class="section-title">Browse by content type</h2>
    </div>
    <div class="explore-grid">
        {sections.map((sec) => (
            <a href={sec.href} class="explore-card">
                <div class="explore-icon-wrap">
                    <span class="explore-icon">{sec.icon}</span>
                </div>
                <div>
                    <h3 class="explore-name">{sec.name}</h3>
                    <p class="explore-desc">{sec.desc}</p>
                </div>
                <span class="explore-count">{sec.count}</span>
            </a>
        ))}
    </div>
</section>


<!-- PILGRIMAGE TRADITIONS (Hubs) -->
{hubs.length > 0 && (
<section class="section container">
    <div class="section-header">
        <span class="section-label">Traditions</span>
        <h2 class="section-title">Pilgrimage across world religions</h2>
    </div>
    <div class="hub-grid">
        {hubs.map((hub, i) => (
            <a href={`/journeys/${hub.slug}`} class="hub-card">
                <div class="hub-card-accent"></div>
                <div class="hub-card-body">
                    <h3 class="hub-card-title">{hub.data.title}</h3>
                    <p class="hub-card-desc">{hub.data.description}</p>
                    <span class="hub-card-link">Read more &rarr;</span>
                </div>
            </a>
        ))}
    </div>
</section>
)}


<!-- LATEST ARTICLES -->
{allContent.length > 0 && (
<section class="latest-section">
    <div class="container">
        <div class="section-header">
            <span class="section-label">Latest</span>
            <h2 class="section-title">Recently published</h2>
        </div>
        <div class="articles-grid">
            {allContent.slice(0, 8).map((item, i) => (
                <a href={item.href} class="article-card">
                    {item.data.image && (
                        <div class="article-card-img">
                            <CdnImage 
                                src={item.data.image} 
                                alt={item.data.imageAlt || item.data.title}
                                width={400} height={225}
                                loading={i < 4 ? 'eager' : 'lazy'}
                                decoding={i < 4 ? 'sync' : 'async'}
                            />
                        </div>
                    )}
                    <div class="article-card-content">
                        <div class="article-card-top">
                            <span class="article-badge">{item.category}</span>
                        </div>
                        <h3 class="article-card-title">{item.data.title}</h3>
                        <p class="article-card-desc">{item.data.description}</p>
                    </div>
                </a>
            ))}
        </div>
        <div class="text-center mt-10">
            <a href="/places" class="btn-outline">View all content &rarr;</a>
        </div>
    </div>
</section>
)}


<!-- ABOUT -->
<section class="section container">
    <div class="about-block">
        <h2 class="about-heading">What is Digging Scriptures?</h2>
        <div class="about-cols">
            <p>
                We examine pilgrimage as a human phenomenon ‚Äî where people have traveled, 
                why they undertook these paths, and how sacred travel has developed across 
                traditions and centuries. Our approach is descriptive and historical, grounded 
                in evidence and respectful of all faith traditions.
            </p>
            <p>
                We cover Christianity, Judaism, Islam, Buddhism, Hinduism, and indigenous 
                practices with equal scholarly rigor. Every article distinguishes documented 
                history from tradition, names its sources, and lets readers form their own 
                conclusions.
            </p>
        </div>
    </div>
</section>

</BaseLayout>

<style>
/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
    background: #1c1917;
    color: #fafaf9;
    position: relative;
    overflow: hidden;
}

.hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 30% 50%, rgba(109,40,217,0.20) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(153,27,27,0.10) 0%, transparent 50%);
    pointer-events: none;
}

.hero-inner {
    position: relative;
    z-index: 1;
    padding: 3rem 0 2.5rem;
}

@media (min-width: 640px) {
    .hero-inner { padding: 5rem 0 4.5rem; }
}

@media (min-width: 900px) {
    .hero-inner { padding: 6rem 0 5.5rem; }
}

.hero-eyebrow {
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.03em;
    color: #8B5CF6;
    margin-bottom: 1.25rem;
}

.hero-title {
    font-size: clamp(1.75rem, 5vw, 3.5rem);
    font-weight: 800;
    line-height: 1.15;
    letter-spacing: -0.03em;
    margin-bottom: 1.25rem;
}

.hero-subtitle {
    max-width: 34rem;
    font-size: 0.9375rem;
    line-height: 1.7;
    color: #a8a29e;
    margin-bottom: 2rem;
}

@media (min-width: 640px) {
    .hero-subtitle { font-size: 1.0625rem; margin-bottom: 2.5rem; }
}

.hero-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
}

.hero-actions .btn,
.btn-outline-hero {
    font-size: 0.8125rem;
    padding: 0.625rem 1.25rem;
}

@media (min-width: 640px) {
    .hero-actions .btn,
    .btn-outline-hero { font-size: 0.875rem; padding: 0.75rem 1.5rem; }
}

.btn-outline-hero {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    border: 1px solid rgba(250,250,249,0.2);
    border-radius: 0.5rem;
    color: #fafaf9;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
}

.btn-outline-hero:hover {
    border-color: rgba(250,250,249,0.5);
    background: rgba(250,250,249,0.05);
}


/* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
.stats-bar {
    background: #ffffff;
    border-bottom: 1px solid var(--color-border);
    padding: 1.25rem 0;
}

@media (min-width: 640px) { .stats-bar { padding: 1.75rem 0; } }

.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    text-align: center;
}

@media (min-width: 480px) {
    .stats-grid { grid-template-columns: repeat(4, 1fr); gap: 1rem; }
}

.stat-number {
    display: block;
    font-size: 1.375rem;
    font-weight: 800;
    color: #1c1917;
    letter-spacing: -0.02em;
}

@media (min-width: 640px) { .stat-number { font-size: 1.75rem; } }

.stat-label {
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: #a8a29e;
    font-weight: 500;
}


/* ‚îÄ‚îÄ SECTION HEADINGS ‚îÄ‚îÄ */
.section-header {
    margin-bottom: 1.5rem;
}

@media (min-width: 640px) { .section-header { margin-bottom: 2rem; } }

.section-label {
    display: inline-block;
    font-size: 0.6875rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--color-primary);
    margin-bottom: 0.375rem;
}

.section-title {
    font-size: 1.375rem;
    font-weight: 800;
    letter-spacing: -0.02em;
    color: var(--color-text-dark);
}

@media (min-width: 640px) { .section-title { font-size: 1.625rem; } }


/* ‚îÄ‚îÄ EXPLORE GRID ‚îÄ‚îÄ */
.explore-grid {
    display: grid;
    gap: 0.625rem;
}

@media (min-width: 640px) {
    .explore-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
}

.explore-card {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.125rem;
    background: #ffffff;
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    text-decoration: none;
    transition: all 0.2s;
    min-width: 0;
}

@media (min-width: 640px) {
    .explore-card { padding: 1.25rem 1.5rem; gap: 1rem; }
}

.explore-card:hover {
    border-color: var(--color-primary);
    box-shadow: 0 2px 12px rgba(0,0,0,0.04);
}

.explore-icon-wrap {
    flex-shrink: 0;
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f5f3ff;
    border-radius: 0.625rem;
    font-size: 1.125rem;
}

@media (min-width: 640px) {
    .explore-icon-wrap { width: 2.75rem; height: 2.75rem; font-size: 1.25rem; }
}

.explore-name {
    font-size: 0.875rem;
    font-weight: 700;
    color: var(--color-text-dark);
    margin-bottom: 0.125rem;
}

.explore-desc {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

@media (min-width: 640px) { .explore-desc { font-size: 0.8125rem; } }

.explore-count {
    margin-left: auto;
    flex-shrink: 0;
    font-size: 1.125rem;
    font-weight: 800;
    color: var(--color-primary);
}


/* ‚îÄ‚îÄ HUB CARDS ‚îÄ‚îÄ */
.hub-grid {
    display: grid;
    gap: 0.75rem;
}

@media (min-width: 640px) {
    .hub-grid { grid-template-columns: repeat(2, 1fr); gap: 1rem; }
}

@media (min-width: 900px) {
    .hub-grid { grid-template-columns: repeat(3, 1fr); }
}

.hub-card {
    display: block;
    background: #ffffff;
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    overflow: hidden;
    text-decoration: none;
    transition: all 0.25s;
}

.hub-card:hover {
    border-color: var(--color-primary);
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    transform: translateY(-2px);
}

.hub-card-accent {
    height: 3px;
    background: linear-gradient(90deg, #6D28D9, #991B1B);
}

.hub-card-body {
    padding: 1.25rem;
}

@media (min-width: 640px) { .hub-card-body { padding: 1.5rem; } }

.hub-card-title {
    font-size: 1rem;
    font-weight: 700;
    color: var(--color-text-dark);
    margin-bottom: 0.375rem;
    line-height: 1.3;
}

@media (min-width: 640px) { .hub-card-title { font-size: 1.0625rem; margin-bottom: 0.5rem; } }

.hub-card-desc {
    font-size: 0.8125rem;
    color: var(--color-text-muted);
    line-height: 1.6;
    margin-bottom: 0.875rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.hub-card-link {
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--color-primary);
    transition: color 0.2s;
}

.hub-card:hover .hub-card-link {
    color: var(--color-accent);
}


/* ‚îÄ‚îÄ LATEST ARTICLES ‚îÄ‚îÄ */
.latest-section {
    background: #ffffff;
    padding: 2.5rem 0;
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
}

@media (min-width: 640px) { .latest-section { padding: 4rem 0; } }

.articles-grid {
    display: grid;
    gap: 0.75rem;
}

@media (min-width: 480px) {
    .articles-grid { grid-template-columns: repeat(2, 1fr); gap: 1rem; }
}

@media (min-width: 900px) {
    .articles-grid { grid-template-columns: repeat(4, 1fr); }
}

.article-card {
    display: flex;
    flex-direction: column;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    text-decoration: none;
    transition: all 0.2s;
    overflow: hidden;
}

.article-card:hover {
    border-color: var(--color-primary);
    background: #ffffff;
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
}

.article-card-img {
    width: 100%;
    height: 140px;
    overflow: hidden;
}

@media (min-width: 640px) { .article-card-img { height: 160px; } }

.article-card-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
}

.article-card:hover .article-card-img img {
    transform: scale(1.05);
}

.article-card-content {
    padding: 1rem;
}

@media (min-width: 640px) { .article-card-content { padding: 1.25rem; } }

.article-card-top {
    margin-bottom: 0.5rem;
}

@media (min-width: 640px) { .article-card-top { margin-bottom: 0.75rem; } }

.article-badge {
    display: inline-block;
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.1875rem 0.4375rem;
    border-radius: 0.375rem;
    background: #f5f3ff;
    color: #6D28D9;
}

@media (min-width: 640px) {
    .article-badge { font-size: 0.6875rem; padding: 0.25rem 0.5rem; }
}

.article-card-title {
    font-size: 0.875rem;
    font-weight: 700;
    color: var(--color-text-dark);
    margin-bottom: 0.25rem;
    line-height: 1.3;
}

@media (min-width: 640px) {
    .article-card-title { font-size: 0.9375rem; margin-bottom: 0.375rem; }
}

.article-card-desc {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

@media (min-width: 640px) { .article-card-desc { font-size: 0.8125rem; } }


/* ‚îÄ‚îÄ ABOUT ‚îÄ‚îÄ */
.about-block {
    max-width: 48rem;
}

.about-heading {
    font-size: 1.25rem;
    font-weight: 800;
    color: var(--color-text-dark);
    letter-spacing: -0.02em;
    margin-bottom: 1rem;
    padding-bottom: 0.875rem;
    border-bottom: 2px solid var(--color-primary);
    display: inline-block;
}

@media (min-width: 640px) {
    .about-heading { font-size: 1.375rem; margin-bottom: 1.25rem; padding-bottom: 1rem; }
}

.about-cols {
    display: grid;
    gap: 1rem;
}

@media (min-width: 640px) {
    .about-cols { grid-template-columns: 1fr 1fr; gap: 2rem; }
}

.about-cols p {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    line-height: 1.75;
    margin: 0;
}

@media (min-width: 640px) { .about-cols p { font-size: 0.9375rem; } }
</style>
