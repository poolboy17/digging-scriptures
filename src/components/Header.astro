---
const navItems = [
    { linkText: 'Journeys', href: '/journeys' },
    { linkText: 'Cities', href: '/cities' },
    { linkText: 'Places', href: '/places' },
    { linkText: 'Routes', href: '/routes' },
    { linkText: 'Stories', href: '/stories' },
    { linkText: 'Context', href: '/context' },
    { linkText: 'Blog', href: '/blog' },
];

const currentPath = Astro.url.pathname;
---

<div class="header-outer">
    <div class="container">
        <header class="header">
            <a href="/" class="header-wordmark">
                Digging<span class="header-wordmark-accent">Scriptures</span>
            </a>

        {/* Desktop nav */}
        <nav class="header-desktop-nav" aria-label="Main navigation">
            {navItems.map((item) => (
                <a 
                    href={item.href} 
                    class:list={[
                        "header-link",
                        (currentPath === item.href || currentPath.startsWith(item.href + '/'))
                            && "header-link--active"
                    ]}
                >
                    {item.linkText}
                </a>
            ))}
        </nav>

        {/* Mobile menu button */}
        <button class="header-menu-btn" id="menu-toggle" aria-label="Open menu" aria-expanded="false">
            <svg class="header-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
                <line x1="3" y1="7" x2="21" y2="7" class="menu-line menu-line-top" />
                <line x1="3" y1="12" x2="21" y2="12" class="menu-line menu-line-mid" />
                <line x1="3" y1="17" x2="21" y2="17" class="menu-line menu-line-bot" />
            </svg>
        </button>
        </header>
    </div>
</div>

{/* Mobile overlay */}
<div class="mobile-overlay" id="mobile-overlay"></div>
<nav class="mobile-drawer" id="mobile-drawer" aria-hidden="true">
    <div class="mobile-drawer-head">
        <a href="/" class="header-wordmark">
            Digging<span class="header-wordmark-accent">Scriptures</span>
        </a>
        <button class="mobile-close-btn" id="menu-close" aria-label="Close menu">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" width="20" height="20">
                <line x1="6" y1="6" x2="18" y2="18" /><line x1="18" y1="6" x2="6" y2="18" />
            </svg>
        </button>
    </div>
    <ul class="mobile-drawer-links">
        {navItems.map((item) => (
            <li>
                <a 
                    href={item.href} 
                    class:list={[
                        "mobile-link",
                        (currentPath === item.href || currentPath.startsWith(item.href + '/'))
                            && "mobile-link--active"
                    ]}
                >
                    {item.linkText}
                </a>
            </li>
        ))}
    </ul>
    <div class="mobile-drawer-foot">
        <p class="mobile-drawer-tagline">Sacred places · Ancient routes · Living traditions</p>
    </div>
</nav>

<script>
    const btn = document.getElementById('menu-toggle');
    const close = document.getElementById('menu-close');
    const drawer = document.getElementById('mobile-drawer');
    const overlay = document.getElementById('mobile-overlay');

    function openMenu() {
        drawer?.classList.add('mobile-drawer--open');
        overlay?.classList.add('mobile-overlay--visible');
        document.body.style.overflow = 'hidden';
        btn?.setAttribute('aria-expanded', 'true');
    }
    function closeMenu() {
        drawer?.classList.remove('mobile-drawer--open');
        overlay?.classList.remove('mobile-overlay--visible');
        document.body.style.overflow = '';
        btn?.setAttribute('aria-expanded', 'false');
    }

    btn?.addEventListener('click', openMenu);
    close?.addEventListener('click', closeMenu);
    overlay?.addEventListener('click', closeMenu);
</script>

<style>
    /* ═══════════════════════════════════════════ */
    /* HEADER BAR                                  */
    /* ═══════════════════════════════════════════ */
    .header-outer {
        position: sticky;
        top: 0;
        z-index: 100;
        background: rgba(255,255,255,0.92);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--color-border);
    }

    .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 3.5rem;
    }

    @media (min-width: 768px) {
        .header { height: 4rem; }
    }

    /* ── Wordmark ── */
    .header-wordmark {
        font-family: var(--font-serif);
        font-size: 1.1875rem;
        font-weight: 700;
        color: var(--color-text-dark);
        text-decoration: none;
        letter-spacing: -0.02em;
        line-height: 1;
        transition: color 0.2s;
    }

    .header-wordmark:hover {
        color: var(--color-primary);
    }

    .header-wordmark-accent {
        color: var(--color-primary);
    }

    @media (min-width: 768px) {
        .header-wordmark { font-size: 1.3125rem; }
    }

    /* ── Desktop nav ── */
    .header-desktop-nav {
        display: none;
        align-items: center;
        gap: 0.125rem;
    }

    @media (min-width: 768px) {
        .header-desktop-nav { display: flex; }
    }

    .header-link {
        position: relative;
        padding: 0.4375rem 0.875rem;
        font-size: 0.8125rem;
        font-weight: 500;
        color: var(--color-text-muted);
        text-decoration: none;
        letter-spacing: 0.01em;
        transition: color 0.15s;
    }

    .header-link:hover {
        color: var(--color-text-dark);
    }

    .header-link--active {
        color: var(--color-primary);
        font-weight: 600;
    }

    .header-link--active::after {
        content: '';
        position: absolute;
        bottom: -0.125rem;
        left: 0.875rem;
        right: 0.875rem;
        height: 2px;
        background: var(--color-primary);
        border-radius: 1px;
    }

    /* ── Menu button ── */
    .header-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 2.25rem;
        height: 2.25rem;
        border: none;
        background: none;
        cursor: pointer;
        color: var(--color-text-dark);
        border-radius: 0.375rem;
        transition: background 0.15s;
    }

    .header-menu-btn:hover { background: var(--color-light); }

    @media (min-width: 768px) { .header-menu-btn { display: none; } }

    .header-menu-icon {
        width: 22px;
        height: 22px;
    }


    /* ═══════════════════════════════════════════ */
    /* MOBILE DRAWER                               */
    /* ═══════════════════════════════════════════ */
    .mobile-overlay {
        position: fixed;
        inset: 0;
        z-index: 199;
        background: rgba(0,0,0,0.3);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.25s ease;
    }

    .mobile-overlay--visible {
        opacity: 1;
        pointer-events: auto;
    }

    .mobile-drawer {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        z-index: 200;
        width: min(20rem, 85vw);
        background: #ffffff;
        box-shadow: -4px 0 24px rgba(0,0,0,0.08);
        transform: translateX(100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
    }

    .mobile-drawer--open {
        transform: translateX(0);
    }

    @media (min-width: 768px) {
        .mobile-drawer { display: none !important; }
        .mobile-overlay { display: none !important; }
    }

    .mobile-drawer-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--color-border);
    }

    .mobile-close-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 2rem;
        height: 2rem;
        border: none;
        background: none;
        cursor: pointer;
        color: var(--color-text-muted);
        border-radius: 0.375rem;
        transition: all 0.15s;
    }

    .mobile-close-btn:hover {
        background: var(--color-light);
        color: var(--color-text-dark);
    }

    .mobile-drawer-links {
        list-style: none;
        margin: 0;
        padding: 1rem 1rem;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.125rem;
    }

    .mobile-link {
        display: block;
        padding: 0.875rem 0.75rem;
        font-size: 0.9375rem;
        font-weight: 500;
        color: var(--color-text-muted);
        text-decoration: none;
        border-radius: 0.5rem;
        transition: all 0.15s;
        letter-spacing: 0.005em;
    }

    .mobile-link:hover {
        background: var(--color-light);
        color: var(--color-text-dark);
    }

    .mobile-link--active {
        color: var(--color-primary);
        font-weight: 600;
        background: color-mix(in srgb, var(--color-primary) 6%, transparent);
    }

    .mobile-drawer-foot {
        padding: 1.25rem 1.5rem;
        border-top: 1px solid var(--color-border);
    }

    .mobile-drawer-tagline {
        font-size: 0.75rem;
        color: var(--color-text-light);
        margin: 0;
        letter-spacing: 0.01em;
    }
</style>
