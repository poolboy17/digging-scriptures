---
import BaseLayout from './BaseLayout.astro';
import CdnImage from '../components/CdnImage.astro';
import NewsletterSignup from '../components/NewsletterSignup.astro';

interface Props {
    title: string;
    description: string;
    publishDate: Date;
    author: string;
    tags?: string[];
    image?: string;
    imageAlt?: string;
}

const {
    title,
    description,
    publishDate,
    author,
    tags,
    image,
    imageAlt,
} = Astro.props;

const dateStr = publishDate.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
});

const articleSchema = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": title,
    "description": description,
    "datePublished": publishDate.toISOString(),
    "author": {
        "@type": "Organization",
        "name": author,
        "url": "https://diggingscriptures.com/about"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Digging Scriptures",
        "url": "https://diggingscriptures.com"
    },
    "url": `https://diggingscriptures.com${Astro.url.pathname}`,
    ...(image && { "image": `https://diggingscriptures.com${image}` })
};
---

<BaseLayout
    title={title}
    description={description}
    image={image}
    schema={articleSchema}
    breadcrumbs={[
        { name: 'Home', url: '/' },
        { name: 'Blog', url: '/blog' },
        { name: title, url: Astro.url.pathname },
    ]}
>
    <article class="section">
        <div class="container">
            <div style="max-width: 65ch; margin: 0 auto;">
                <header class="mb-8">
                    <p class="text-sm text-text-light mb-2">
                        <time datetime={publishDate.toISOString()}>{dateStr}</time>
                        {tags && tags.length > 0 && (
                            <span> Â· {tags.join(', ')}</span>
                        )}
                    </p>
                    <h1 class="text-3xl md:text-4xl font-bold leading-tight mb-4">{title}</h1>
                    <p class="text-lg text-text-light">{description}</p>
                </header>

                {image && (
                    <div class="hero-image mb-8 rounded-xl overflow-hidden">
                        <CdnImage
                            src={image}
                            alt={imageAlt || title}
                            widths={[600, 900, 1200]}
                            class="w-full"
                        />
                    </div>
                )}

                <div class="content prose-custom">
                    <slot />
                </div>

                <NewsletterSignup />
            </div>
        </div>
    </article>
</BaseLayout>
