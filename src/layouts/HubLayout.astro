---
/**
 * ================================================================================
 * HUB PAGE TEMPLATE
 * ================================================================================
 * Purpose: Authority pages that define topics and link downward
 * Word count target: 2000-3000 words
 * 
 * MONETIZATION: NEVER
 * NO CTAs, NO affiliate links, NO ads in this template
 * 
 * This template is LOCKED. Do not modify section order without review.
 * ================================================================================
 */

import BaseLayout from './BaseLayout.astro';
import { getCollection } from 'astro:content';

interface Props {
    title: string;
    description: string;
    topics?: string[];
    relatedPlaces?: string[];
    relatedRoutes?: string[];
    content: string;
}

const { title, description, topics, relatedPlaces, relatedRoutes, content } = Astro.props;

// Fetch related content for internal linking
const allPlaces = relatedPlaces ? await getCollection('places', ({ data }) => 
    relatedPlaces.includes(data.title) && !data.draft
) : [];

const allRoutes = relatedRoutes ? await getCollection('routes', ({ data }) => 
    relatedRoutes.includes(data.title) && !data.draft
) : [];
---

<BaseLayout 
    title={title} 
    description={description}
    breadcrumbs={[
        { name: 'Home', url: '/' },
        { name: 'Journeys', url: '/journeys' },
        { name: title, url: Astro.url.pathname }
    ]}
    schema={{
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": title,
        "description": description,
        "url": `https://diggingscriptures.com${Astro.url.pathname}`,
        "publisher": {
            "@type": "Organization",
            "name": "Digging Scriptures"
        }
    }}
>
    <article class="section">
        <div class="container">
        
            <!-- HEADER -->
            <header class="mb-10">
                <div class="card-meta mb-4">
                    <span class="badge">Journey</span>
                </div>
                <h1 class="mb-4">{title}</h1>
                <p class="text-lg text-text-muted leading-relaxed">{description}</p>
            </header>

            <!-- MAIN CONTENT -->
            <section class="content mb-12">
                <slot />
            </section>

        <!-- ================================================================== -->
        <!-- SECTION 3: RELATED PLACES -->
        <!-- Purpose: Internal links to place pages -->
        <!-- Monetization: FORBIDDEN -->
        <!-- ================================================================== -->
        {allPlaces.length > 0 && (
            <section class="mt-12 pt-8 border-t border-border">
                <h2 class="mb-6">Sacred Places</h2>
                <div class="grid gap-6 sm:grid-cols-2">
                    {allPlaces.map((place) => (
                        <a href={`/places/${place.slug}`} class="card block p-5 rounded-lg bg-light">
                            <h3 class="mb-2 text-text-dark">{place.data.title}</h3>
                            <p class="text-sm text-text-muted">{place.data.description}</p>
                        </a>
                    ))}
                </div>
            </section>
        )}

        {allRoutes.length > 0 && (
            <section class="mt-12 pt-8 border-t border-border">
                <h2 class="mb-6">Pilgrimage Routes</h2>
                <div class="grid gap-6 sm:grid-cols-2">
                    {allRoutes.map((route) => (
                        <a href={`/routes/${route.slug}`} class="card block p-5 rounded-lg bg-light">
                            <h3 class="mb-2 text-text-dark">{route.data.title}</h3>
                            <p class="text-sm text-text-muted">{route.data.description}</p>
                        </a>
                    ))}
                </div>
            </section>
        )}

        <!-- ================================================================== -->
        <!-- SECTION 5: CONTEXT LINKS -->
        <!-- Purpose: Links to background/context articles -->
        <!-- Monetization: FORBIDDEN -->
        <!-- ================================================================== -->
        <section class="mt-12 pt-8 border-t border-border">
            <h2 class="mb-4">Further Reading</h2>
            <slot name="context-links" />
        </section>

        </div>
    </article>
</BaseLayout>
